<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/ui.xhtml">

<!--<ui:define name="head">
    <style type="text/css">
        .datalist-noborder .ui-widget-content {
            border: none;
            color: #999999;
        }

        .help-row {
            vertical-align: top;
        }

        .input-col-s {
            width: 45px;
        }

        .input-col-m {
            width: 60px;
        }

        .input-col-l {
            width: 80px;
        }

        .input-col-xl {
            width: 140px;
        }
    </style>
    <script language="JavaScript" type="text/JavaScript">
        //<![CDATA[
        function KeyDown() {
            if (event.keyCode == 13) {//keyCode = 13 -> Enter
                if (event.srcElement.id == 'inputform:funcde') {
                    checkvchatt();
                    document.forms['inputform']['inputform:actno'].focus();
                    document.forms['inputform']['inputform:save'].click();
                } else if (event.srcElement.id == 'inputform:tlrnum') {
                    checktlrnum();
                    event.keyCode = 9;
                } else if (event.srcElement.id == 'vchsetform:vchset') {
                    event.returnValue = false;
                    event.cancel = true;
                    document.forms['vchsetform']['vchsetform:modifyvchset'].click();
                } else if (event.srcElement.id == 'authform:password') {
                    event.returnValue = false;
                    event.cancel = true;
                    document.forms['authform']['authform:authlogin'].click();
                } else {
                    event.keyCode = 9;//keyCode = 9 -> Tab
                }
            }
            if (event.keyCode == 38) {//keyCode = 38 -> Up
                if (event.srcElement.id == 'inputform:type') {
                    document.forms['inputform']['inputform:actno'].focus();
                } else if (event.srcElement.id == 'inputform:txnamt') {
                    document.forms['inputform']['inputform:type'].focus();
                } else if (event.srcElement.id == 'inputform:valdat') {
                    document.forms['inputform']['inputform:txnamt'].focus();
                } else if (event.srcElement.id == 'inputform:anacde') {
                    document.forms['inputform']['inputform:valdat'].focus();
                } else if (event.srcElement.id == 'inputform:furinf') {
                    document.forms['inputform']['inputform:anacde'].focus();
                } else if (event.srcElement.id == 'inputform:vchatt') {
                    document.forms['inputform']['inputform:furinf'].focus();
                }
            }
        }

        function handleConfirmDeleteAll() {
            confirmDeleteAll.show();
            window.event.keyCode = 9;
            //jQuery(PrimeFaces.escapeClientId('confirmform:canceldeleteall')).focus();
        }

        function handleInputComplete(xhr, status, args, id, nextid) {
            if (args) {
                var isValid = args.isValid;
                if (!isValid) {
                    document.forms['inputform']['inputform:' + id].focus();
                } else {
                    if (id == 'valdat') {
                        var inputvaldat = document.forms['inputform']['inputform:valdat'].value;
                        var lastvaldat = document.forms['inputform']['inputform:lastvaldat'].value;
                        var vchaut = document.forms['inputform']['inputform:vchaut'].value;
                        var sysdate = document.forms['inputform']['inputform:sysdate'].value;
                        var tlrnum = document.forms['inputform']['inputform:tlrnum'].value;
                        if ((inputvaldat != "") && (inputvaldat != sysdate)
                                && (vchaut == "" || (vchaut != "" && inputvaldat != lastvaldat))) {
                            document.forms['authform']['authform:workuser'].value = tlrnum;
                            authdlg.show();
                            //jQuery(function(){jQuery(PrimeFaces.escapeClientId('authform:username')).focus();});
                            event.keyCode = 46; //keycode   46 = Delete
                            //document.forms['authform']['authform:username'].focus;
                            jQuery(PrimeFaces.escapeClientId('authform:username')).focus();
                        }
                        if (inputvaldat == "") {
                            document.forms['inputform']['inputform:vchaut'].value = "";
                        }
                    }
                }
            }
        }

        function handleVchsetRequest(xhr, status, args) {
            if (args.validationFailed || !args.result) {
                jQuery('#dialog').effect("shake", { times: 3 }, 100);
            } else {
                vchsetdlg.hide();
            }
        }

        function handleLoginRequest(xhr, status, args) {
            if (args.validationFailed || !args.loggedIn) {
                jQuery('#authdialog').effect("shake", { times: 3 }, 100);
            } else {
                authdlg.hide();
                var vchaut = document.forms['authform']['authform:username'].value;
                document.forms['inputform']['inputform:lastvaldat'].value = document.forms['inputform']['inputform:valdat'].value;
                document.forms['inputform']['inputform:vchaut'].value = vchaut;
                document.forms['inputform']['inputform:anacde'].focus();
            }
        }

        var submitted = false;

        function checkDoubleSubmit(f) {
            //alert(submitted);
            if (submitted) {
                window.alert("请勿重复提交!");
                return false;
            } else {
                submitted = true;
                return true;
            }
        }

        //]]>
    </script>
</ui:define>
<ui:define name="head">
    <style type="text/css">
        .col-95 {
            width: 95%;
        }

        .col-5 {
            width: 5%;
        }

        .col-label {
            text-align: right;
        }

        .col-input {
            width: 150px;
            text-align: left;
        }

        .col-label2 {
            width: 70px;
            text-align: right;
        }

        .col-input2 {
            width: 130px;
            text-align: left;
        }
    </style>

    <script language="JavaScript" type="text/JavaScript">
        document.onkeydown = function TabReplace() {
            if (event.keyCode == 13) {
                document.forms['form']['form:btn'].click();
                event.keyCode = 9;
            }
        }
    </script>
</ui:define>-->
<ui:define name="head">
    <style type="text/css">
        .col-label {
            text-align: right;
            font-size: 12px !important;
            font-weight: bold;
        }

        .col-input {
            width: 150px;
            font-size: 12px !important;
            text-align: left;
            font-weight: bold;
        }

        .col-label2 {
            width: 150px;
            font-size: 12px !important;
            text-align: right;
            font-weight: bold;
        }

        .col-input2 {
            font-size: 12px !important;
            text-align: left;
            font-weight: bold;
        }
    </style>
    <script language="JavaScript" type="text/JavaScript">
        document.onkeydown = function TabReplace() {
            if (event.keyCode == 13) {
                event.keyCode = 9;
            } if (event.srcElement.id == 'btns') {
                document.forms['btns']['btns:save'].focus();
                document.forms['btns']['btn:save'].click();
            }
        }
    </script>
</ui:define>
<ui:define name="content">
    <div class="entry" id="top">
        <p:messages id="msgs" showDetail="true" showSummary="true"/>
        <h:form id="inputform" onsubmit="return checkDoubleSubmit(this);">
            <p:focus for="actnum"/>
            <p:panel header="【传票录入】 当前套号:[#{batchBookAction.vchset}]" id="input">
                <h:panelGrid id="addtable" columns="2" style="width: 100%">
                    <h:panelGrid width="85%" style="padding-top:5px;padding-bottom:2px;" columns="6" cellspacing="2"
                                 columnClasses="input-col-m,input-col-xl,input-col-m,input-col-xl,input-col-s,input-col-xl,input-col-l,input-col-xl">

                        <h:outputLabel value="传票序号* :" for="setseq"/>
                        <h:inputText autocomplete="off" id="setseq" value="#{batchBookAction.m8401.SETSEQ}"
                                     required="true" onkeydown="KeyDown()" onfocus="this.select()">
                        </h:inputText>
                        <h:outputLabel value="帐号* :" for="actnum"/>
                        <h:inputText autocomplete="off" id="actnum" value="#{batchBookAction.m8401.ACTNUM}"
                                     required="true" onkeydown="KeyDown()" onfocus="this.select()">
                        </h:inputText>
                        <h:outputLabel value="交易金额* :" for="txnamt"/>
                        <h:inputText autocomplete="off" id="txnamt" value="#{batchBookAction.m8401.TXNAMT}"
                                     required="true" onkeydown="KeyDown()" onfocus="this.select()">
                        </h:inputText>
                        <h:outputLabel value="冲正标志* :" for="rvslbl"/>
                        <h:inputText autocomplete="off" id="rvslbl" value="#{batchBookAction.m8401.RVSLBL}"
                                     required="true" onkeydown="KeyDown()" onfocus="this.select()">
                        </h:inputText>
                        <h:outputLabel value="交易日期* :" for="opnda2"/>
                        <h:inputText autocomplete="off" id="opnda2" value="#{batchBookAction.m8401.OPNDA2}"
                                     required="true" onkeydown="KeyDown()" onfocus="this.select()"
                                     onclick="WdatePicker({dateFmt:'yyyyMMdd'})">
                        </h:inputText>
                        <h:outputLabel value="记帐日期*:" for="erydat"/>
                        <h:inputText autocomplete="off" id="erydat" value="#{batchBookAction.m8401.ERYDAT}"
                                     onfocus="this.select()" onkeydown="KeyDown()"
                                     onclick="WdatePicker({dateFmt:'yyyyMMdd'})"/>
                    </h:panelGrid>
                    <h:panelGrid id="btns" columns="1" cellspacing="5" cellpadding="0"  width="10%" >
                        <p:commandButton id="save" value="确定" ajax="false" onfocus="this.select()"
                                         onkeydown="KeyDown()"
                                         action="#{batchBookAction.onCreateNewRecord}"
                                         style="width:66px; " update="pdt,show">
                        </p:commandButton>
                    </h:panelGrid><!--display:none-->
                </h:panelGrid>
                <p:separator/>
                <h:panelGrid id="show" columns="8" columnClasses="input-col-m,input-col-xl,input-col-m,input-col-xl,
                    input-col-s,input-col-xl,input-col-l,input-col-xl">
                    <h:outputLabel value="贷方合计 :"/>
                    <h:inputText id="creditamt" value="#{batchBookAction.totalCreditAmt}" disabled="true"
                                 style="text-align:right">
                        <f:convertNumber type="number" pattern="###,###,###,###,##0.00"/>
                    </h:inputText>
                    <h:outputLabel value="借方合计 :"/>
                    <h:inputText id="debitamt" value="#{batchBookAction.totalDebitAmt}" disabled="true"
                                 style="text-align:right">
                        <f:convertNumber type="number" pattern="###,###,###,###,##0.00"/>
                    </h:inputText>
                    <h:outputLabel value="轧差 :"/>
                    <h:inputText id="totalamt" value="#{batchBookAction.totalAmt}" disabled="true"
                                 style="text-align:right">
                        <f:convertNumber type="number" pattern="#,###,###,###,##0.00"/>
                    </h:inputText>
                    <h:outputLabel value="传票套号 :"/>
                    <h:inputText value="#{batchBookAction.vchset}" disabled="true"
                                 style="text-align:right;">
                        <f:convertNumber type="number" pattern="0000"/>
                    </h:inputText>
                </h:panelGrid>
            </p:panel>
        </h:form>
        <h:form id="dtform" style="margin-top: 10px">
            <p:menubar>
                <p:menuitem value="【套平】" icon="ui-icon ui-icon-gear" type="push"
                            actionListener="#{batchBookAction.onBalanceAct()}"
                            ajax="false" update="pdt,dtform,msgs"  process="@form"/>
                <p:menuitem value="【套修改】" icon="ui-icon ui-icon-pencil" type="push" onclick="vchsetdlg.show();
                             document.forms['vchsetform']['vchsetform:vchset'].focus();"
                             /><!--ajax="false" update="pdt,dtform,msgs" process="@form"-->
                <p:menuitem value="【套删除】" icon="ui-icon ui-icon-newwin" type="push"
                            ajax="false" update="pdt,dtform,msgs"  process="@form"
                            actionListener="#{batchBookAction.onDeleteVchset()}"/>
                <p:menuitem value="【多笔删除】" icon="ui-icon ui-icon-close"
                            action="#{batchBookAction.onMultiConfirm}" type="push"
                            ajax="true" update="pdt,dtform"/>
            </p:menubar>
            <p:dialog id="dialog" header="已套平传票修改" widgetVar="vchsetdlg" modal="true">
                <p:growl id="vchsetgrowl" globalOnly="true" showDetail="true"/>
                <h:panelGrid columns="1" cellpadding="5">
                    <h:outputLabel for="vchset" value="请输入传票套号: *"/>
                    <h:inputText value="#{batchBookAction.vchset}" onfocus="this.select()"
                                 id="vchset" required="true" label="vchset" onkeydown="KeyDown()">
                    </h:inputText>
                    <f:facet name="footer">
                        <p:commandButton id="modifyvchset" value="确定" update="pdt" ajax="true"
                                         actionListener="#{batchBookAction.onBoolVchset()}"
                                         oncomplete="vchsetdlg.hide();"/>
                        <p:commandButton value="取消" onclick="vchsetdlg.hide()" type="button"/>
                    </f:facet>
                </h:panelGrid>
            </p:dialog>
            <p:dataTable id="pdt" height="200" selection="#{batchBookAction.selectedRecords}"
                         value="#{batchBookAction.dataList}" var="record"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks}
                          {NextPageLink} {LastPageLink} {RowsPerPageDropdown} 最大总笔数：#{99}"
                         paginator="true" rows="10" paginatorPosition="bottom"
                         rowKey="#{record.SETSEQ}" rowsPerPageTemplate="100,50,15,10,5"
                         emptyMessage="传票记录为空..." style="margin-top:10px">

                <!--<p:column style="display:none;" headerText="pkid">
                    <h:outputText value="#{record.SETSEQ}"/>
                </p:column>-->
                <p:column selectionMode="multiple" style=" text-align:center;"/>

                <p:column headerText="序号" style="text-align:center" sortBy="#{record.SETSEQ}">
                    <h:outputText id="setseq" value="#{record.SETSEQ}"/>
                </p:column>

                <p:column headerText="帐号" style="text-align:center">
                    <h:outputText value="#{record.ACTNUM}"/>
                </p:column>

                <p:column headerText="金额" style="text-align:center" sortBy="#{record.TXNAMT}">
                    <h:outputText value="#{record.TXNAMT}" style="float: right ">
                        <f:convertNumber type="number" pattern="#,###,###,###,##0.00"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="冲正标志" style="text-align:center">
                    <h:outputText value="#{record.RVSLBL}"/>
                </p:column>

                <p:column headerText="凭证号码" style="text-align:center">
                    <h:outputText value="#{record.ERYTIM}"/>
                </p:column>
                <p:column headerText="冲补/起息日" style="text-align:center">

                    <h:outputText value="#{record.VALDAT}">
                    </h:outputText>
                </p:column>

                <p:column headerText="附件" style="text-align:center">
                    <h:outputText value="#{record.VCHATT}"/>
                </p:column>

                <p:column headerText="操作" style="text-align:center">
                    <h:commandLink immediate="true" value="删除" style="color: blue" ajax="false"
                                   action="#{batchBookAction.onDeleteRecord()}">
                        <f:param value="#{batchBookAction.vchset}" name="vchset"/>
                        <f:param value="#{record.SETSEQ}" name="setseq"/>
                    </h:commandLink>
                </p:column>
            </p:dataTable>
        </h:form>
        <br/>
    </div>
    <div>
        <p:outputLabel style="font-size: 12px !important;font-weight: bold;color: grey;"
                       value="冲正标志：11-现金， 12-转账， 22-冲正， 52补账"/>
        <br/><br/>
        <p:outputLabel style="font-size: 12px !important;font-weight: bold;color: grey;"
                       value="凭证种类：101-转账支票， 109-进账单， 114-利息单,
        117-特转凭证， 118-电汇凭证, 119-税单, 120-其他凭证,121-其他公会经费，"/>
        <br/><br/>
        <p:outputLabel style="font-size: 12px !important;font-weight: bold;color: grey;"
                       value="122-其他预算拨款， 123-其他社保费，124-其他公积金，
         125-其他收费凭证， 126-其他银联业务， 202-现金支票， 225-现金交款单"/>
        <p:separator/>
    </div>
</ui:define>
</ui:composition>